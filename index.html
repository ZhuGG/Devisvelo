<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Extracteur de pi√®ces ‚Äì Coucou Max</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="brand">
        <img src="logo.webp" alt="Devis V√©lo" class="brand-logo" />
        <div class="brand-text">
          <h1>Extracteur de pi√®ces ‚Äî Coucou Max</h1>
        </div>
      </div>
      <div class="badge">
        <span class="badge-dot"></span>
        <span>Local ‚Ä¢ Offline</span>
      </div>
    </header>

    <main>
      <section class="card">
        <div class="card-content">
          <div class="card-header">
            <div>
              <div class="card-kicker">√âtape 1</div>
              <div class="card-title">D√©poser le PDF de devis</div>
            </div>
          </div>

          <label
            class="drop-zone"
            id="dropZone"
            tabindex="0"
            role="button"
            aria-label="D√©poser un devis PDF pour analyser les articles"
          >
            <div class="drop-icon" aria-hidden="true">üìÑ</div>
            <div class="drop-copy drop-copy--default">
              <div class="drop-title">D√©pose ton devis PDF ici</div>
              <div class="drop-subtitle">
                Le fichier reste sur ton ordinateur. Analyse 100 % locale.
              </div>
              <div class="drop-subtitle-note">
                ou clique pour le s√©lectionner ‚Äî un seul PDF √† la fois.
              </div>
            </div>
            <div class="drop-copy drop-copy--drag">
              <div class="drop-title">Rel√¢che pour lancer l‚Äôanalyse du devis</div>
              <div class="drop-subtitle">L‚Äôimport est instantan√© et reste local.</div>
            </div>
            <div class="drop-copy drop-copy--loading">
              <div class="drop-loader" role="presentation"></div>
              <div>
                <div class="drop-title">Analyse du devis en cours‚Ä¶</div>
                <div class="drop-subtitle">Patiente quelques secondes.</div>
              </div>
            </div>
            <button type="button" class="btn btn-secondary" id="browseButton">
              Parcourir‚Ä¶
            </button>
            <input
              type="file"
              class="file-input"
              id="fileInput"
              accept="application/pdf"
            />
          </label>
          <div
            class="drop-status"
            id="dropStatus"
            role="status"
            aria-live="polite"
            aria-atomic="true"
            aria-hidden="true"
          ></div>

          <div class="preview-wrapper">
            <canvas id="previewCanvas"></canvas>
            <div class="preview-caption">
              Pr√©visualisation de la premi√®re page pour valider le document import√©.
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-content">
          <div class="card-header card-header--spaced">
            <div>
              <div class="card-kicker">√âtape 2</div>
              <div class="card-title">R√©capitulatif des pi√®ces extraites</div>
            </div>
            <button class="btn" id="exportButton" disabled>
              Exporter en CSV
            </button>
          </div>

          <div class="stats-row" id="statsRow">
            <div class="stat-pill">
              Pages analys√©es :
              <span class="value" id="statPages">0</span>
            </div>
            <div class="stat-pill">
              Lignes trouv√©es :
              <span class="value" id="statRows">0</span>
            </div>
            <div class="stat-pill">
              Articles uniques :
              <span class="value" id="statItems">0</span>
            </div>
            <div class="stats-note" id="statsNote" role="status" aria-live="polite">
              Aucun article trouv√©.
            </div>
          </div>

          <div id="resultsContainer">
            <div class="empty-state" id="emptyState">
              <div class="empty-illustration" aria-hidden="true">üõ†Ô∏è</div>
              <h3>Aucun devis analys√© pour le moment</h3>
              <p>D√©pose un PDF √† gauche pour voir ici les articles d√©tect√©s.</p>
            </div>

            <div class="results-state" id="resultsState">
              <div class="results-context" id="resultsContext">
                <span class="results-context-icon" aria-hidden="true">‚ÑπÔ∏è</span>
                <p>
                  Les lignes sont interpr√©t√©es √† partir du tableau ARTICLES / QT√â / PU /
                  TVA / TOTAL. Si un article manque ou semble incorrect, v√©rifie le format
                  du devis.
                </p>
              </div>

              <div class="results-wrapper" id="resultsWrapper">
                <table>
                  <thead>
                    <tr>
                      <th>Article</th>
                      <th class="qty-header">Quantit√© totale</th>
                    </tr>
                  </thead>
                  <tbody id="resultsBody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      v1 ‚Äî Lecture PDF c√¥t√© client avec PDF.js.
    </footer>
  </div>

  <div class="toast" id="toast"></div>

  <script type="module" src="./assets/js/main.js"></script>
</body>
</html>
